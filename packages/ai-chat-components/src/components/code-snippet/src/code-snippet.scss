/*
 *  Copyright IBM Corp. 2025
 *
 *  This source code is licensed under the Apache-2.0 license found in the
 *  LICENSE file in the root directory of this source tree.
 */

@use "sass:string";

@use "@carbon/styles/scss/components/code-snippet/index";
@use "@carbon/styles/scss/type";
@use "@carbon/layout";
@use "@carbon/styles/scss/motion";
@use "@carbon/styles/scss/themes";
@use "@carbon/styles/scss/theme";
@use "@carbon/styles/scss/colors";
@use "@carbon/styles/scss/spacing";
@use "@carbon/styles/scss/utilities/focus-outline" as *;
@use "../../../globals/scss/vars" as *;
@use "../../../globals/scss/modifiers" as *;

:host {
  @include rounded-modifiers;

  // Automatically output all syntax-* tokens from the Carbon $white theme
  @each $token, $value in themes.$white {
    @if string.index($token, "syntax-") == 1 {
      --cds-#{$token}: #{$value};
    }
  }

  /* Operators and punctuation */
  --cds-syntax-operator: #{colors.$cool-gray-80};
  --cds-syntax-deref-operator: var(--cds-syntax-operator);
  --cds-syntax-arithmetic-operator: var(--cds-syntax-operator);
  --cds-syntax-logic-operator: var(--cds-syntax-operator);
  --cds-syntax-bitwise-operator: var(--cds-syntax-operator);
  --cds-syntax-compare-operator: var(--cds-syntax-operator);
  --cds-syntax-update-operator: var(--cds-syntax-operator);
  --cds-syntax-definition-operator: #{theme.$syntax-definition-keyword};
  --cds-syntax-type-operator: #{theme.$syntax-tag};
  --cds-syntax-control-operator: #{theme.$syntax-module-keyword};
  --cds-syntax-modifier: #{theme.$syntax-keyword};
  --cds-syntax-punctuation: #{colors.$cool-gray-80};
  --cds-syntax-separator: var(--cds-syntax-punctuation);
  --cds-syntax-bracket: var(--cds-syntax-punctuation);
  --cds-syntax-angle-bracket: #{colors.$cool-gray-60};
  --cds-syntax-square-bracket: var(--cds-syntax-bracket);
  --cds-syntax-paren: var(--cds-syntax-bracket);
  --cds-syntax-brace: var(--cds-syntax-bracket);

  /* Structural text */
  --cds-syntax-content: var(--cds-text-primary);
  --cds-syntax-heading: #{colors.$cyan-70};
  --cds-syntax-heading-1: var(--cds-syntax-heading);
  --cds-syntax-heading-2: var(--cds-syntax-heading);
  --cds-syntax-heading-3: var(--cds-syntax-heading);
  --cds-syntax-heading-4: var(--cds-syntax-heading);
  --cds-syntax-heading-5: var(--cds-syntax-heading);
  --cds-syntax-heading-6: var(--cds-syntax-heading);
  --cds-syntax-content-separator: var(--cds-syntax-punctuation);
  --cds-syntax-list: var(--cds-syntax-content);
  --cds-syntax-quote: var(--cds-syntax-comment);
  --cds-syntax-emphasis: var(--cds-syntax-content);
  --cds-syntax-strong: var(--cds-syntax-content);
  --cds-syntax-monospace: var(--cds-syntax-content);
  --cds-syntax-link: #{colors.$blue-60};
  --cds-syntax-strikethrough: var(--cds-syntax-content);

  /* Diagnostics (core only) */
  --cds-syntax-invalid: #{colors.$red-60};

  /* Meta and annotations */
  --cds-syntax-meta: #{colors.$green-60};
  --cds-syntax-document-meta: var(--cds-syntax-meta);
  --cds-syntax-annotation: #{colors.$teal-60};
  --cds-syntax-processing-instruction: #{theme.$syntax-string};

  /* Modifiers */
  --cds-syntax-definition: #{colors.$cyan-70};
  --cds-syntax-constant: #{colors.$blue-60};
  --cds-syntax-function: #{colors.$yellow-60};
  --cds-syntax-standard: #{colors.$blue-60};
  --cds-syntax-local: #{colors.$blue-60};
  --cds-syntax-special: #{colors.$blue-60};
}

.#{$prefix}--snippet {
  @extend .#{$cds-prefix}--snippet;
  @extend .#{$cds-prefix}--snippet--multi;

  @include rounded-self;

  display: block;
  padding: 0;

  background: theme.$background;
  max-inline-size: 100%;
}

:host-context([data-theme="g90"]),
:host-context([storybook-carbon-theme="g90"]),
:host-context([data-theme="g100"]),
:host-context([storybook-carbon-theme="g100"]) {
  @each $token, $value in themes.$g90 {
    @if string.index($token, "syntax-") == 1 {
      --cds-#{$token}: #{$value};
    }
  }

  /* Literals and primitives */
  --cds-syntax-operator: #{colors.$gray-20};
  --cds-syntax-punctuation: #{colors.$gray-20};
  --cds-syntax-angle-bracket: #{colors.$gray-50};

  /* Structural text */
  --cds-syntax-heading: #{colors.$cyan-40};
  --cds-syntax-link: #{colors.$blue-50};

  /* Diagnostics (core only) */
  --cds-syntax-invalid: #{colors.$red-50};

  /* Meta and annotations */
  --cds-syntax-meta: #{colors.$green-40};
  --cds-syntax-annotation: #{colors.$teal-40};

  /* Modifiers */
  --cds-syntax-definition: #{colors.$cyan-40};
  --cds-syntax-constant: #{colors.$blue-50};
  --cds-syntax-function: #{colors.$yellow-30};
  --cds-syntax-standard: #{colors.$blue-50};
  --cds-syntax-local: #{colors.$blue-30};
  --cds-syntax-special: #{colors.$blue-50};
}

:host([disabled]) {
  @extend .#{$cds-prefix}--snippet--disabled;

  .#{$prefix}--snippet-container {
    cursor: not-allowed;
  }

  .cm-editor {
    pointer-events: none;
  }
}

:host([hide-copy-button]) {
  @extend .#{$cds-prefix}--snippet--no-copy;
}

:host([wrap-text]) {
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
  }
}

.#{$prefix}--snippet-container {
  @extend .#{$cds-prefix}--snippet-container;

  position: relative;
}

:host([expanded-code]) .#{$prefix}--snippet-container {
  padding-block-end: spacing.$spacing-05;
  transition: max-height motion.$duration-moderate-01
    motion(standard, productive);
}

.#{$prefix}--snippet--codemirror {
  ::slotted(*) {
    display: none;
  }
  .#{$prefix}--code-editor {
    block-size: 100%;
    inline-size: 100%;
  }
}

.#{$prefix}--snippet__editor-skeleton {
  position: absolute;
  z-index: 1;
  display: flex;
  align-items: center;
  padding: spacing.$spacing-05;
  background: theme.$layer-01;
  inset: 0;
  pointer-events: none;

  cds-skeleton-text {
    inline-size: 100%;
  }
}

.#{$prefix}--visually-hidden {
  display: none;
}

.#{$prefix}--snippet__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: theme.$layer-01;
  border-block-end: 1px solid theme.$border-subtle-02;
  padding-inline-start: layout.$spacing-05;
}

.#{$prefix}--snippet__meta {
  display: flex;
}

.#{$prefix}--snippet__footer {
  display: flex;
  justify-content: flex-end;
  border-block-start: 1px solid theme.$border-subtle-02;
}

.#{$prefix}--snippet-btn--text {
  color: theme.$text-primary;
}

.#{$prefix}--snippet__language,
.#{$prefix}--snippet__header-separator,
.#{$prefix}--snippet__linecount {
  @include type.type-style("label-01");
}

.#{$prefix}--snippet__header-separator {
  padding-inline-end: layout.$spacing-02;
  padding-inline-start: layout.$spacing-02;
}

.#{$prefix}--snippet-container--collapsed {
  overflow-x: auto;
  overflow-y: hidden;
  transition: max-height motion.$duration-moderate-01
    motion(standard, productive);
}

.#{$prefix}--icon-chevron--down {
  transform: rotate(0deg);
  transition: transform motion.$transition-expansion;
}

:host([expanded-code]) .#{$prefix}--icon-chevron--down {
  transform: rotate(180deg);
  transition: transform motion.$transition-expansion;
}
